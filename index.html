<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Capsule Ferrofluid Study</title>
    <link rel="stylesheet" href="./styles.css" />
    <script type="module" src="./main.js"></script>
  </head>
  <body>
    <canvas id="scene" aria-label="ferrofluid simulation"></canvas>

    <section class="hud hud-left" aria-label="simulation and audio controls">
      <h1>Capsule Ferrofluid</h1>
      <p>Driver-based ferrofluid motion and real-time audio control.</p>

      <div class="hud-section" data-collapsible data-default-collapsed="true">
        <button class="hud-section-toggle" type="button" aria-expanded="false">
          <span class="hud-group-title">Profiles</span>
          <span class="hud-section-chevron" aria-hidden="true"></span>
        </button>

        <label for="settingsProfile">Settings profile</label>
        <div class="control-row">
          <select id="settingsProfile"></select>
        </div>

        <div class="button-row">
          <button id="profileLoad" type="button">Load</button>
          <button id="profileSave" type="button">Save</button>
          <button id="profileDelete" type="button">Delete</button>
        </div>

        <label for="profileName">Save as new</label>
        <div class="control-row">
          <input id="profileName" type="text" maxlength="40" placeholder="Profile name" />
        </div>

        <div class="button-row button-row-single">
          <button id="profileSaveAs" type="button">Save as new profile</button>
        </div>

        <p class="audio-status" id="profileStatus">Profiles: ready</p>
      </div>

      <div class="hud-section" data-collapsible>
        <button class="hud-section-toggle" type="button" aria-expanded="true">
          <span class="hud-group-title">Fluid Dynamics</span>
          <span class="hud-section-chevron" aria-hidden="true"></span>
        </button>

        <label for="magnetStrength">Magnet strength</label>
        <div class="control-row">
          <input id="magnetStrength" type="range" min="0" max="5000" step="1" value="1753" />
          <output id="magnetStrength-value">1753</output>
        </div>

        <label for="magnetSize">Magnet size</label>
        <div class="control-row">
          <input id="magnetSize" type="range" min="0.35" max="5.0" step="0.01" value="1.60" />
          <output id="magnetSize-value">1.60</output>
        </div>

        <label for="gravity">Gravity</label>
        <div class="control-row">
          <input id="gravity" type="range" min="0" max="180" step="1" value="0" />
          <output id="gravity-value">0</output>
        </div>

        <label for="density">Density</label>
        <div class="control-row">
          <input id="density" type="range" min="0.5" max="2.2" step="0.01" value="1.34" />
          <output id="density-value">1.34</output>
        </div>

        <label for="viscosity">Viscosity</label>
        <div class="control-row">
          <input id="viscosity" type="range" min="0" max="0.6" step="0.001" value="0.145" />
          <output id="viscosity-value">0.145</output>
        </div>

        <label for="resistance">Resistance</label>
        <div class="control-row">
          <input id="resistance" type="range" min="0" max="2.2" step="0.01" value="0.04" />
          <output id="resistance-value">0.04</output>
        </div>

        <label for="surfaceTension">Surface tension</label>
        <div class="control-row">
          <input id="surfaceTension" type="range" min="0" max="4.0" step="0.01" value="0.00" />
          <output id="surfaceTension-value">0.00</output>
        </div>

        <label for="blobCohesion">Blob cohesion</label>
        <div class="control-row">
          <input id="blobCohesion" type="range" min="0" max="8.0" step="0.01" value="0.00" />
          <output id="blobCohesion-value">0.00</output>
        </div>
      </div>

      <div class="hud-section" data-collapsible>
        <button class="hud-section-toggle" type="button" aria-expanded="true">
          <span class="hud-group-title">Drive</span>
          <span class="hud-section-chevron" aria-hidden="true"></span>
        </button>

        <label for="pulseHz">Pulse rate (Hz)</label>
        <div class="control-row">
          <input id="pulseHz" type="range" min="0.5" max="18" step="0.1" value="8.4" />
          <output id="pulseHz-value">8.4</output>
        </div>

        <label for="pulseAggression">Pulse aggression</label>
        <div class="control-row">
          <input id="pulseAggression" type="range" min="0" max="14" step="0.1" value="7.2" />
          <output id="pulseAggression-value">7.2</output>
        </div>

        <label for="driverTravel">Driver travel</label>
        <div class="control-row">
          <input id="driverTravel" type="range" min="0" max="0.080" step="0.001" value="0.080" />
          <output id="driverTravel-value">0.080</output>
        </div>

        <label class="checkbox-row" for="manualPulse">
          <input id="manualPulse" type="checkbox" />
          <span>Manual pulse mode (mouse)</span>
        </label>

        <label class="checkbox-row" for="audioReactive">
          <input id="audioReactive" type="checkbox" checked />
          <span>Audio reactive drive</span>
        </label>

        <label for="driveMode">Driver behavior</label>
        <div class="control-row">
          <select id="driveMode">
            <option value="gate">Magnet on/off</option>
            <option value="inout" selected>Magnet in/out</option>
          </select>
        </div>
      </div>

      <div class="hud-section" data-collapsible>
        <button class="hud-section-toggle" type="button" aria-expanded="true">
          <span class="hud-group-title">Audio Input</span>
          <span class="hud-section-chevron" aria-hidden="true"></span>
        </button>

        <label for="audioFile">Music file</label>
        <div class="control-row">
          <input id="audioFile" type="file" accept="audio/*" />
        </div>

        <div class="button-row">
          <button id="audioToggle" type="button">Play file</button>
          <button id="micToggle" type="button">Use mic</button>
          <button id="systemToggle" type="button">Use system</button>
        </div>

        <label for="audioSensitivity">Audio sensitivity</label>
        <div class="control-row">
          <input id="audioSensitivity" type="range" min="0.4" max="8.0" step="0.01" value="1.56" />
          <output id="audioSensitivity-value">1.56</output>
        </div>

        <label for="audioSmoothing">Audio smoothing</label>
        <div class="control-row">
          <input id="audioSmoothing" type="range" min="0" max="0.98" step="0.01" value="0.98" />
          <output id="audioSmoothing-value">0.98</output>
        </div>

        <label for="audioThreshold">Audio threshold</label>
        <div class="control-row">
          <input id="audioThreshold" type="range" min="0" max="0.7" step="0.01" value="0.70" />
          <output id="audioThreshold-value">0.70</output>
        </div>

        <p class="audio-status" id="audioStatus">Audio source: none</p>
      </div>
    </section>

    <section class="hud hud-right" aria-label="render and lighting controls">
      <div class="hud-section" data-collapsible>
        <button class="hud-section-toggle" type="button" aria-expanded="true">
          <span class="hud-group-title">Render</span>
          <span class="hud-section-chevron" aria-hidden="true"></span>
        </button>

        <label for="renderQuality">Render quality</label>
        <div class="control-row">
          <input id="renderQuality" type="range" min="0.6" max="2.4" step="0.05" value="0.85" />
          <output id="renderQuality-value">0.85</output>
        </div>

        <label for="cameraOffsetX">Camera offset X</label>
        <div class="control-row">
          <input id="cameraOffsetX" type="range" min="-0.35" max="0.35" step="0.01" value="0.08" />
          <output id="cameraOffsetX-value">0.08</output>
        </div>

        <label for="cameraYaw">Camera yaw (deg)</label>
        <div class="control-row">
          <input id="cameraYaw" type="range" min="-24" max="24" step="0.1" value="10.0" />
          <output id="cameraYaw-value">10.0</output>
        </div>

        <label for="cameraOffsetY">Camera offset Y</label>
        <div class="control-row">
          <input id="cameraOffsetY" type="range" min="-0.35" max="0.35" step="0.01" value="-0.04" />
          <output id="cameraOffsetY-value">-0.04</output>
        </div>

        <label for="capsuleRoundness">Capsule roundness</label>
        <div class="control-row">
          <input id="capsuleRoundness" type="range" min="2.2" max="7.0" step="0.01" value="3.35" />
          <output id="capsuleRoundness-value">3.35</output>
        </div>

        <label for="capsuleWidth">Capsule width</label>
        <div class="control-row">
          <input id="capsuleWidth" type="range" min="0.75" max="1.35" step="0.01" value="1.00" />
          <output id="capsuleWidth-value">1.00</output>
        </div>

        <label for="capsuleHeight">Capsule height</label>
        <div class="control-row">
          <input id="capsuleHeight" type="range" min="0.75" max="1.35" step="0.01" value="1.00" />
          <output id="capsuleHeight-value">1.00</output>
        </div>

        <label class="checkbox-row" for="enableOrbitDrag">
          <input id="enableOrbitDrag" type="checkbox" checked />
          <span>Enable orbit drag</span>
        </label>
        <p class="audio-status">Right-drag (or Alt/Shift + drag) to orbit.</p>
        <div class="button-row button-row-single">
          <button id="resetOrbitView" type="button">Reset orbit</button>
        </div>

        <label for="fluidColor">Fluid color</label>
        <div class="control-row">
          <input id="fluidColor" type="color" value="#0062ff" />
          <output id="fluidColor-value">#0062ff</output>
        </div>

        <label for="fluidTint">Fluid tint</label>
        <div class="control-row">
          <input id="fluidTint" type="range" min="0" max="1" step="0.01" value="0.81" />
          <output id="fluidTint-value">0.81</output>
        </div>

        <label class="checkbox-row" for="viewMagnet">
          <input id="viewMagnet" type="checkbox" />
          <span>View magnet</span>
        </label>
      </div>

      <div class="hud-section" data-collapsible>
        <button class="hud-section-toggle" type="button" aria-expanded="true">
          <span class="hud-group-title">Material</span>
          <span class="hud-section-chevron" aria-hidden="true"></span>
        </button>

        <label for="reflectivity">Reflectivity</label>
        <div class="control-row">
          <input id="reflectivity" type="range" min="0" max="2.2" step="0.01" value="2.20" />
          <output id="reflectivity-value">2.20</output>
        </div>

        <label for="surfaceSharpness">Surface sharpness</label>
        <div class="control-row">
          <input id="surfaceSharpness" type="range" min="0.6" max="2.6" step="0.01" value="2.60" />
          <output id="surfaceSharpness-value">2.60</output>
        </div>

        <label for="depthBoost">Depth boost</label>
        <div class="control-row">
          <input id="depthBoost" type="range" min="0.7" max="2.5" step="0.01" value="2.50" />
          <output id="depthBoost-value">2.50</output>
        </div>

        <label for="reflectionClarity">Reflection clarity</label>
        <div class="control-row">
          <input id="reflectionClarity" type="range" min="0.5" max="2.5" step="0.01" value="1.20" />
          <output id="reflectionClarity-value">1.20</output>
        </div>

        <label for="impactHighlights">Impact highlights</label>
        <div class="control-row">
          <input id="impactHighlights" type="range" min="0" max="2.5" step="0.01" value="2.50" />
          <output id="impactHighlights-value">2.50</output>
        </div>

        <label for="iridescenceStrength">Oil-slick intensity</label>
        <div class="control-row">
          <input id="iridescenceStrength" type="range" min="0" max="2.4" step="0.01" value="0.00" />
          <output id="iridescenceStrength-value">0.00</output>
        </div>

        <label for="plexiFilmStrength">Plexi film</label>
        <div class="control-row">
          <input id="plexiFilmStrength" type="range" min="0" max="1.2" step="0.01" value="0.24" />
          <output id="plexiFilmStrength-value">0.24</output>
        </div>

        <label for="plexiFilmDiffusion">Plexi diffusion</label>
        <div class="control-row">
          <input id="plexiFilmDiffusion" type="range" min="0" max="1" step="0.01" value="0.42" />
          <output id="plexiFilmDiffusion-value">0.42</output>
        </div>
      </div>

      <div class="hud-section" data-collapsible>
        <button class="hud-section-toggle" type="button" aria-expanded="true">
          <span class="hud-group-title">LED Ring</span>
          <span class="hud-section-chevron" aria-hidden="true"></span>
        </button>

        <p class="audio-status" id="hdriStatus">HDRI: loading...</p>

        <label class="checkbox-row" for="useHdriReflections">
          <input id="useHdriReflections" type="checkbox" checked />
          <span>Use HDR reflections</span>
        </label>

        <label class="checkbox-row" for="showEnvironment">
          <input id="showEnvironment" type="checkbox" />
          <span>Show HDR environment</span>
        </label>

        <label for="environmentStrength">Environment strength</label>
        <div class="control-row">
          <input id="environmentStrength" type="range" min="0" max="1.5" step="0.01" value="0.88" />
          <output id="environmentStrength-value">0.88</output>
        </div>

        <label for="pointLightColor">LED color</label>
        <div class="control-row">
          <input id="pointLightColor" type="color" value="#ff0000" />
          <output id="pointLightColor-value">#ff0000</output>
        </div>

        <label for="pointLightIntensity">LED intensity</label>
        <div class="control-row">
          <input id="pointLightIntensity" type="range" min="0" max="2.2" step="0.01" value="2.20" />
          <output id="pointLightIntensity-value">2.20</output>
        </div>

        <label for="sideLightStrength">Side illumination</label>
        <div class="control-row">
          <input id="sideLightStrength" type="range" min="0" max="2.5" step="0.01" value="2.50" />
          <output id="sideLightStrength-value">2.50</output>
        </div>

        <label for="envLightStrength">HDRI response</label>
        <div class="control-row">
          <input id="envLightStrength" type="range" min="0" max="2.5" step="0.01" value="1.20" />
          <output id="envLightStrength-value">1.20</output>
        </div>

        <label for="exposure">Exposure</label>
        <div class="control-row">
          <input id="exposure" type="range" min="0.6" max="1.8" step="0.01" value="1.06" />
          <output id="exposure-value">1.06</output>
        </div>

        <label for="pointLightOffsetX">LED bias X</label>
        <div class="control-row">
          <input id="pointLightOffsetX" type="range" min="-1" max="1" step="0.01" value="-0.25" />
          <output id="pointLightOffsetX-value">-0.25</output>
        </div>

        <label for="pointLightOffsetY">LED bias Y</label>
        <div class="control-row">
          <input id="pointLightOffsetY" type="range" min="-1" max="1" step="0.01" value="-0.47" />
          <output id="pointLightOffsetY-value">-0.47</output>
        </div>
      </div>

      <div class="hud-section" data-collapsible data-default-collapsed="true">
        <button class="hud-section-toggle" type="button" aria-expanded="false">
          <span class="hud-group-title">Performance</span>
          <span class="hud-section-chevron" aria-hidden="true"></span>
        </button>
        <p class="audio-status">FPS: <span id="perfFps">--</span></p>
        <p class="audio-status">Step (physics): <span id="perfStepMs">--</span> ms</p>
        <p class="audio-status">Field build: <span id="perfFieldMs">--</span> ms</p>
        <p class="audio-status">Field shading: <span id="perfShadeMs">--</span> ms</p>
        <p class="audio-status">Draw/composite: <span id="perfDrawMs">--</span> ms</p>
        <p class="audio-status" id="perfBottleneck">Bottleneck: --</p>
      </div>
    </section>
  </body>
</html>
